# OpenSSH hardening for Ubuntu 24.04+ (OpenSSH 9.6+) with key-only auth
# Sources:
# - Ubuntu Server docs (OpenSSH server): https://documentation.ubuntu.com/server/how-to/security/openssh-server/
# - OpenSSH manpages: man sshd_config (https://manpages.ubuntu.com/manpages/noble/man5/sshd_config.5.html)
# - CIS Ubuntu 24.04 Benchmark (overview): https://www.cisecurity.org/benchmark/ubuntu_linux

# Authentication: enforce keys only (disable passwords/interactive prompts)
PubkeyAuthentication yes
# Enforce keys-only at the auth method layer
AuthenticationMethods publickey
# Explicitly disable keyboard-interactive/PAM prompts
PasswordAuthentication no
# leaving this enabled can still allow password-like prompts even if PasswordAuthentication no is set
# so it's best to disable it
KbdInteractiveAuthentication no

# Root login policy (disallow direct root logins)
PermitRootLogin no

# Conservative auth limits (tighter than defaults; reduce brute-force window)
MaxAuthTries 3
# Shorten unauthenticated session window (see CVE-2024-6387 context)
LoginGraceTime 30

# Strong host key (ed25519 only; fast and secure on modern clients)
HostKey /etc/ssh/ssh_host_ed25519_key

# Limit to IPv4 sockets to avoid unintended IPv6 exposure if firewall misses v6
AddressFamily inet

# Reduce attack surface (disable rarely needed forwarding features on servers)
# No GUI forwarding
X11Forwarding no
# Prevent agent socket exposure
AllowAgentForwarding no
# Disable local/remote port forwarding
AllowTcpForwarding no

# Logging (VERBOSE records key fingerprint used for auth)
LogLevel VERBOSE